{% extends "base.html" %}

{% block title %}View Employees - Project Tracking System{% endblock %}
{% block styles %}
<style>
    .drop-up {
        bottom: 100%;
        top: auto !important;
        margin-bottom: 0.5rem;
    }

    .dropdown-menu {
        transform-origin: top right;
        transition: opacity 0.2s ease-in-out;
        pointer-events: auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto lg:px-2 max-md:w-[23rem]">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="mb-4">
        {% for category, message in messages %}
        <div class="px-4 py-2 rounded text-white
                    {{ 'bg-green-600' if category == 'success' else 'bg-red-600' }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <div class="bg-white shadow rounded-lg">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900  pt-4">Employee List</h1>
        </div>
        <div class="px-4 py-5 sm:p-6">
            <!-- Status Filter Dropdown -->
            <div class="mb-4">
                <form method="GET" action="{{ url_for('view_employees') }}">
                    <label for="status_filter" class="mr-2 text-sm font-medium text-gray-700">Filter by Status:</label>
                    <select id="status_filter" name="status_filter" onchange="this.form.submit()"
                        class="border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all" {% if status_filter=='all' %}selected{% endif %}>All</option>
                        <option value="active" {% if status_filter=='active' %}selected{% endif %}>Active</option>
                        <option value="inactive" {% if status_filter=='inactive' %}selected{% endif %}>Inactive</option>
                    </select>
                </form>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Email</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Phone</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Type</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for employee in employees %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">{{ employee[1] }} {{ employee[2] }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">{{ employee[7] }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">{{ employee[6] }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                    {% if employee[9] == 'admin' %}bg-purple-100 text-purple-800
                                    {% else %}bg-blue-100 text-blue-800{% endif %}">
                                    {{ employee[9].title() }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                    {% if employee[8] == 'active' %}bg-green-100 text-green-800
                                    {% else %}bg-red-100 text-red-800{% endif %}">
                                    {{ employee[8].title() }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium relative">
                                <div class="relative inline-block text-left">
                                    <button onclick="toggleDropdown(this)"
                                        class="inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                                        Actions
                                        <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd"
                                                d="M5.23 7.21a.75.75 0 011.06.02L10 11.586l3.71-4.356a.75.75 0 011.14.976l-4.25 5a.75.75 0 01-1.14 0l-4.25-5a.75.75 0 01.02-1.06z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                    <div
                                        class="hidden absolute origin-top-right z-50 w-36 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 dropdown-menu">
                                        <a href="{{ url_for('edit_employee', emp_id=employee[0]) }}"
                                            class="block px-4 py-2 text-sm text-gray-700 hover:bg-yellow-100">
                                            <i class="fas fa-edit mr-1 text-yellow-600"></i> Edit
                                        </a>
                                        <a href="{{ url_for('manage_profile', emp_id=employee[0]) }}"
                                            class="block px-4 py-2 text-sm text-blue-700 hover:bg-blue-100">
                                            <i class="fas fa-id-card mr-1 text-blue-500"></i> Profile
                                        </a>
                                        <!-- <button
                                            onclick="confirmDelete('employee',{{employee[0] }}, '{{ url_for('delete_employee', emp_id=employee[0]) }}')"
                                            class="w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-100">
                                            <i class="fas fa-trash mr-1"></i> Delete
                                        </button> -->
                                    </div>
                                </div>
            </div>
            </td>

            </tr>
            {% endfor %}
            </tbody>
            </table>
        </div>
    </div>
</div>
</div>

<script>
    function confirmDelete(type, id, url) {
        if (confirm(`Are you sure you want to delete this ${type}?`)) {
            window.location.href = url;
        }
    }
</script>
<script>
    function toggleDropdown(button) {
        // Hide all dropdowns
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
            menu.classList.add('hidden');
            menu.classList.remove('drop-up');
        });

        const menu = button.nextElementSibling;

        // Check available space
        const rect = button.getBoundingClientRect();
        const menuHeight = menu.offsetHeight;
        const spaceBelow = window.innerHeight - rect.bottom;

        if (spaceBelow < menuHeight && rect.top > menuHeight) {
            menu.classList.add('drop-up');
        }

        menu.classList.toggle('hidden');
    }
    document.addEventListener('click', function (event) {
        const dropdowns = document.querySelectorAll('.dropdown-menu');
        dropdowns.forEach(menu => {
            if (!menu.contains(event.target) && !menu.previousElementSibling.contains(event.target)) {
                menu.classList.add('hidden');
            }
        });
    });
</script>
{% endblock %}